CREATE TABLE users (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(100) NOT NULL,
    role VARCHAR2(20) CHECK (role IN ('STUDENT','HOST','REVIEWER')),
    created_at TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE sessions (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    host_id NUMBER REFERENCES users(id),
    title VARCHAR2(255) NOT NULL,
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    status VARCHAR2(20) DEFAULT 'PLANNED' CHECK (status IN ('PLANNED','RUNNING','ENDED')),
    created_at TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE questions (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    session_id NUMBER REFERENCES sessions(id),
    text CLOB NOT NULL,
    order_no NUMBER DEFAULT 1,
    created_at TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE answers (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    question_id NUMBER REFERENCES questions(id),
    user_id NUMBER REFERENCES users(id),
    text CLOB NOT NULL,
    score NUMBER CHECK (score BETWEEN 1 AND 10),
    created_at TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE feedbacks (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    answer_id NUMBER REFERENCES answers(id),
    summary CLOB,
    strengths CLOB,
    weaknesses CLOB,
    improvement CLOB,
    model VARCHAR2(50) DEFAULT 'GPT-4',
    created_at TIMESTAMP DEFAULT SYSTIMESTAMP
);