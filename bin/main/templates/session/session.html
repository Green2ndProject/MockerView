<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="'면접 진행 - ' + ${sessionTitle}">면접 진행 - MockerView</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/session.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a class="navbar-brand" href="/session/list">Mockerview</a>
                <div class="navbar-nav">
                    <a class="nav-link" th:href="@{/session/list}">세션 목록</a>
                    <span class="nav-text" th:text="'사용자: ' + ${userName}">사용자: 테스트</span>
                    <span class="nav-text" th:text="'역할: ' + ${currentUser.role}">역할: STUDENT</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="page-header">
        <div class="container">
            <div class="page-title">
                <h1 th:text="${sessionTitle}">모의면접 세션</h1>
                <div class="session-status">
                    <span class="badge badge-live">진행 중</span>
                    <span id="session-stats">질문: 0개 | 답변: 0개</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="session-container">
            <div class="main-content">
                <div class="question-section">
                    <h3>현재 질문</h3>
                    <div id="current-question" class="current-question">
                        <p id="current-question-text">질문이 출제될 때까지 기다려주세요.</p>
                    </div>
                    <input type="hidden" id="currentQuestionId" value="">

                    <div th:if="${isHost}" class="question-form">
                        <h4>새 질문 출제</h4>
                        <div class="form-row">
                            <input type="text" id="newQuestionText" placeholder="질문을 입력하세요..." class="form-control">
                            <input type="number" id="newQuestionOrder" placeholder="순서" min="1" value="1" class="form-control" style="width: 100px;">
                            <button onclick="sendQuestion()" class="btn btn-primary">질문 출제</button>
                        </div>
                    </div>
                </div>

                <div class="answer-section" th:if="${!isHost}">
                    <h3>답변 작성</h3>
                    <div class="answer-form">
                        <textarea id="answerText" placeholder="답변을 입력하세요..." class="form-control" rows="4"></textarea>
                        <button onclick="submitAnswer()" class="btn btn-success">답변 제출</button>
                    </div>
                </div>

                <div class="answers-section">
                    <h3>제출된 답변</h3>
                    <div id="answers-list" class="answers-list">
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="participants-section">
                    <h4>참가자 목록</h4>
                    <ul id="participants-list" class="participants-list">
                        <li th:text="${userName}">현재 사용자</li>
                    </ul>
                </div>

                <div class="feedback-section">
                    <h4>AI 피드백</h4>
                    <div id="ai-feedback-list" class="ai-feedback-list">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="sessionId" th:value="${sessionId}">
    <input type="hidden" id="userId" th:value="${userId}">
    <input type="hidden" id="userName" th:value="${userName}">
    <input type="hidden" id="userRole" th:value="${currentUser.role}">

    <div id="toast-container" class="toast-container"></div>

    <script src="/webjars/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/2.3.4/stomp.min.js"></script>
    <script src="/js/mockerview-websocket.js"></script>
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof SockJS === 'undefined') {
                console.error('SockJS 라이브러리가 로드되지 않았습니다.');
                return;
            }
            if (typeof Stomp === 'undefined') {
                console.error('Stomp 라이브러리가 로드되지 않았습니다.');
                return;
            }
            
            const sessionId = /*[[${sessionId}]]*/ 1;
            const userId = /*[[${userId}]]*/ 1;
            const userName = /*[[${userName}]]*/ '테스트사용자';
            
            console.log('WebSocket 초기화 시작:', sessionId, userId, userName);
            initializeWebSocket(sessionId, userId, userName);
        });
    </script>
</body>
</html>