<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <div th:replace="~{fragments/head :: head}"></div>
    <title>ë©´ì ‘ê´€ í™œë™ í†µê³„ - MockerView</title>
    <div th:replace="~{fragments/styles :: styles}"></div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      body {
        background: #f8f9fa;
        padding-top: 70px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .stats-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        border-bottom: 2px solid #e5e7eb;
        margin-bottom: 20px;
      }

      .stats-header h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1a1a1a;
      }

      .export-buttons {
        display: flex;
        gap: 8px;
      }

      .btn {
        padding: 6px 12px;
        border-radius: 4px;
        font-weight: 600;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
      }

      .btn-primary {
        background: #667eea;
        color: white;
        border: none;
      }

      .btn-outline {
        background: white;
        color: #667eea;
        border: 1px solid #667eea;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        padding: 16px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      }

      .stat-label {
        font-size: 0.75rem;
        color: #6b7280;
        margin-bottom: 4px;
      }

      .stat-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1a1a1a;
      }

      .main-content {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .chart-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      }

      .chart-header {
        font-size: 0.875rem;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 12px;
      }

      canvas {
        max-height: 250px;
      }

      .ranking-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      }

      .ranking-header {
        font-size: 0.875rem;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 12px;
      }

      .ranking-item {
        display: flex;
        align-items: center;
        padding: 8px;
        border-radius: 6px;
        margin-bottom: 6px;
        background: #f9fafb;
      }

      .ranking-item:hover {
        background: #f3f4f6;
      }

      .rank-badge {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 0.75rem;
        font-weight: 700;
        margin-right: 12px;
      }

      .rank-badge.gold {
        background: #fef3c7;
        color: #f59e0b;
      }

      .rank-badge.silver {
        background: #f3f4f6;
        color: #6b7280;
      }

      .rank-badge.bronze {
        background: #fed7aa;
        color: #d97706;
      }

      .rank-badge.other {
        background: #e5e7eb;
        color: #6b7280;
      }

      .ranking-name {
        flex: 1;
        font-size: 0.8125rem;
        font-weight: 600;
        color: #374151;
      }

      .ranking-score {
        font-size: 0.8125rem;
        font-weight: 700;
        color: #667eea;
      }

      .sessions-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        margin-bottom: 20px;
      }

      .sessions-header {
        font-size: 0.875rem;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 12px;
      }

      .session-item {
        padding: 12px;
        border-radius: 6px;
        background: #f9fafb;
        margin-bottom: 8px;
        border-left: 3px solid #667eea;
      }

      .session-title {
        font-size: 0.8125rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 4px;
      }

      .session-meta {
        font-size: 0.6875rem;
        color: #6b7280;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #9ca3af;
      }

      .empty-icon {
        font-size: 3rem;
        margin-bottom: 12px;
      }

      .empty-text {
        font-size: 0.875rem;
        font-weight: 600;
      }

      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .main-content {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <nav th:replace="~{fragments/navbar :: navbar}"></nav>

    <div class="container">
      <div class="stats-header">
        <h1>ğŸ“Š ë©´ì ‘ê´€ í™œë™ í†µê³„</h1>
        <div class="export-buttons">
          <a href="/auth/mypage" class="btn btn-outline">â† ëŒì•„ê°€ê¸°</a>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">ì£¼ìµœí•œ ë©´ì ‘</div>
          <div class="stat-number" th:text="${totalHostedSessions}">0</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">ì™„ë£Œëœ ì„¸ì…˜</div>
          <div class="stat-number" th:text="${endedSessionsCount}">0</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">ì œê³µí•œ í”¼ë“œë°±</div>
          <div class="stat-number" th:text="${totalFeedbacksGiven}">0</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">í‰ê·  ì ìˆ˜</div>
          <div class="stat-number" th:text="${avgGivenScore}">0.0</div>
        </div>
      </div>

      <div class="main-content">
        <div class="chart-container">
          <div class="chart-header">ì›”ë³„ ì„¸ì…˜ ì¶”ì´</div>
          <canvas id="sessionsByMonthChart"></canvas>
        </div>

        <div class="ranking-container">
          <div class="ranking-header">ë©´ì ‘ì ìˆœìœ„ Top 10</div>
          <div
            th:if="${topInterviewees != null and !topInterviewees.isEmpty()}"
          >
            <div
              class="ranking-item"
              th:each="interviewee, stat : ${topInterviewees}"
            >
              <div
                class="rank-badge"
                th:classappend="${stat.index == 0} ? 'gold' : (${stat.index == 1} ? 'silver' : (${stat.index == 2} ? 'bronze' : 'other'))"
                th:text="${stat.index + 1}"
              >
                1
              </div>
              <div class="ranking-name" th:text="${interviewee[1]}">
                ì‚¬ìš©ìëª…
              </div>
              <div
                class="ranking-score"
                th:text="${#numbers.formatDecimal(interviewee[2], 1, 1)} + 'ì '"
              >
                0.0ì 
              </div>
            </div>
          </div>
          <div
            class="empty-state"
            th:if="${topInterviewees == null or topInterviewees.isEmpty()}"
          >
            <div class="empty-icon">ğŸ‘¤</div>
            <div class="empty-text">ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        </div>
      </div>

      <div
        class="sessions-container"
        th:if="${hostedSessions != null and !hostedSessions.isEmpty()}"
      >
        <div class="sessions-header">ìµœê·¼ ì£¼ìµœí•œ ë©´ì ‘ ì„¸ì…˜</div>
        <div th:each="sess, stat : ${hostedSessions}">
          <div class="session-item" th:if="${stat.index < 10}">
            <div class="session-title" th:text="${sess.title}">ì„¸ì…˜ ì œëª©</div>
            <div class="session-meta">
              <span
                th:text="${#temporals.format(sess.createdAt, 'yyyyë…„ MMì›” ddì¼ HH:mm')}"
                >ë‚ ì§œ</span
              >
              <span> â€¢ </span>
              <span th:text="${sess.status}">ìƒíƒœ</span>
            </div>
          </div>
        </div>
      </div>

      <div
        class="sessions-container"
        th:if="${hostedSessions == null or hostedSessions.isEmpty()}"
      >
        <div class="empty-state">
          <div class="empty-icon">ğŸ“­</div>
          <div class="empty-text">ì•„ì§ ì£¼ìµœí•œ ë©´ì ‘ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <div th:replace="~{fragments/scripts :: scripts}"></div>

    <script th:inline="javascript">
      const sessionsByMonthData = /*[[${sessionsByMonth}]]*/ {};
      const months = Object.keys(sessionsByMonthData).sort();
      const counts = months.map((m) => sessionsByMonthData[m]);

      const ctx = document.getElementById("sessionsByMonthChart");
      if (ctx && months.length > 0) {
        new Chart(ctx, {
          type: "line",
          data: {
            labels: months,
            datasets: [
              {
                label: "ì„¸ì…˜ ìˆ˜",
                data: counts,
                borderColor: "#667eea",
                backgroundColor: "rgba(102, 126, 234, 0.1)",
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointBackgroundColor: "#667eea",
                pointBorderColor: "#fff",
                pointBorderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                padding: 12,
                titleFont: {
                  size: 13,
                  weight: 600,
                },
                bodyFont: {
                  size: 12,
                },
                cornerRadius: 6,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1,
                  font: {
                    size: 11,
                  },
                },
                grid: {
                  color: "#f3f4f6",
                },
              },
              x: {
                ticks: {
                  font: {
                    size: 11,
                  },
                },
                grid: {
                  display: false,
                },
              },
            },
          },
        });
      } else if (ctx) {
        const canvas = ctx.getContext("2d");
        canvas.font = "14px sans-serif";
        canvas.fillStyle = "#9ca3af";
        canvas.textAlign = "center";
        canvas.fillText(
          "ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤",
          ctx.width / 2,
          ctx.height / 2
        );
      }
    </script>
  </body>
</html>
