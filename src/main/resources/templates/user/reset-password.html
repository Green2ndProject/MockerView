<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <div th:replace="~{fragments/head :: head}"></div>
    <title>비밀번호 재설정 - MockerView</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      .top-logo {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: white;
        padding: 16px 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        z-index: 100;
      }

      .top-logo a {
        font-size: 1.5rem;
        font-weight: 700;
        color: #667eea;
        text-decoration: none;
        letter-spacing: -0.5px;
      }

      body {
        background: #f8f9fa;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        padding: 20px;
        padding-top: 90px;
      }

      .reset-container {
        max-width: 400px;
        width: 100%;
        padding: 40px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 2px 16px rgba(0, 0, 0, 0.06);
      }

      .reset-container h2 {
        text-align: center;
        margin-bottom: 10px;
        color: #1a1a1a;
        font-size: 1.625rem;
        font-weight: 700;
        letter-spacing: -0.5px;
      }

      .subtitle {
        text-align: center;
        color: #6b7280;
        font-size: 0.9375rem;
        margin-bottom: 30px;
      }

      .reset-container input {
        width: 100%;
        padding: 12px 14px;
        margin: 8px 0;
        border: 1.5px solid #e5e7eb;
        border-radius: 8px;
        box-sizing: border-box;
        font-size: 0.9375rem;
        transition: all 0.2s;
      }

      .reset-container input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .reset-container input::placeholder {
        color: #9ca3af;
      }

      .reset-container input.error {
        border-color: #dc2626;
      }

      .reset-container input.success {
        border-color: #16a34a;
      }

      .error-message {
        color: #dc2626;
        font-size: 0.8125rem;
        margin-top: 6px;
        display: none;
      }

      .error-message.show {
        display: block;
      }

      .success-message {
        color: #16a34a;
        font-size: 0.8125rem;
        margin-top: 6px;
        display: none;
      }

      .success-message.show {
        display: block;
      }

      .reset-container button {
        width: 100%;
        padding: 12px;
        margin: 16px 0;
        border: none;
        border-radius: 8px;
        background: #667eea;
        color: white;
        cursor: pointer;
        font-size: 0.9375rem;
        font-weight: 600;
        transition: all 0.2s;
      }

      .reset-container button:hover {
        background: #5568d3;
      }

      .reset-container button:active {
        transform: scale(0.98);
      }

      .links {
        text-align: center;
        margin-top: 24px;
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: center;
        gap: 16px;
        flex-wrap: wrap;
      }

      .links a {
        color: #667eea;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .links a:hover {
        text-decoration: underline;
      }

      @media (max-width: 480px) {
        .top-logo {
          padding: 14px 16px;
        }

        .top-logo a {
          font-size: 1.25rem;
        }

        body {
          padding: 16px;
          padding-top: 80px;
        }

        .reset-container {
          padding: 32px 24px;
        }

        .reset-container h2 {
          font-size: 1.5rem;
        }

        .links {
          flex-direction: column;
          gap: 12px;
        }
      }
    </style>
    <div th:replace="~{fragments/styles :: styles}"></div>
  </head>
  <body>
    <div class="top-logo">
      <a href="/">MockerView</a>
    </div>

    <div class="reset-container">
      <h2>비밀번호 재설정</h2>
      <p class="subtitle">새로운 비밀번호를 설정하세요</p>

      <form id="resetForm">
        <input type="text" id="username" placeholder="아이디" required />
        <input type="email" id="email" placeholder="이메일" required />
        <input
          type="password"
          id="newPassword"
          placeholder="새 비밀번호 (최소 6자)"
          required
          minlength="6"
        />
        <input
          type="password"
          id="confirmPassword"
          placeholder="새 비밀번호 확인"
          required
          minlength="6"
        />
        <span class="error-message" id="passwordError"
          >비밀번호가 일치하지 않습니다</span
        >
        <span class="success-message" id="passwordSuccess"
          >비밀번호가 일치합니다</span
        >
        <button type="submit">비밀번호 재설정</button>
      </form>

      <div class="links">
        <a href="/auth/login">로그인</a>
        <a href="/auth/find-username">아이디 찾기</a>
      </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <div th:replace="~{fragments/scripts :: scripts}"></div>

    <script>
      const newPasswordInput = document.getElementById("newPassword");
      const confirmPasswordInput = document.getElementById("confirmPassword");
      const passwordError = document.getElementById("passwordError");
      const passwordSuccess = document.getElementById("passwordSuccess");

      function validatePassword() {
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (confirmPassword === "") {
          confirmPasswordInput.classList.remove("error", "success");
          passwordError.classList.remove("show");
          passwordSuccess.classList.remove("show");
          return true;
        }

        if (newPassword === confirmPassword) {
          confirmPasswordInput.classList.remove("error");
          confirmPasswordInput.classList.add("success");
          passwordError.classList.remove("show");
          passwordSuccess.classList.add("show");
          return true;
        } else {
          confirmPasswordInput.classList.remove("success");
          confirmPasswordInput.classList.add("error");
          passwordError.classList.add("show");
          passwordSuccess.classList.remove("show");
          return false;
        }
      }

      newPasswordInput.addEventListener("input", validatePassword);
      confirmPasswordInput.addEventListener("input", validatePassword);

      document
        .getElementById("resetForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          if (!validatePassword()) {
            alert("비밀번호가 일치하지 않습니다.");
            return;
          }

          const username = document.getElementById("username").value;
          const email = document.getElementById("email").value;
          const newPassword = document.getElementById("newPassword").value;

          try {
            const response = await fetch("/auth/reset-password", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, email, newPassword }),
            });

            const data = await response.json();

            if (response.ok) {
              alert(data.message);
              window.location.href = "/auth/login";
            } else {
              alert(data.message);
            }
          } catch (error) {
            alert("오류가 발생했습니다.");
          }
        });
    </script>
    <script src="/js/push-init.js"></script>
    <script src="/js/push-notifications.js"></script>
  </body>
</html>
