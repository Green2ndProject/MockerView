<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>세션 목록 - MockerView</title>
    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/sessionModal.css" />
    <style>
      .search-container {
        margin-bottom: 2rem;
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #e9ecef;
      }
      커밋 테스트 중
      .search-form {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        flex-wrap: wrap;
      }
      
      .search-input {
        flex: 1;
        min-width: 300px;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        border: 1px solid #ced4da;
        border-radius: 4px;
        background: white;
        transition: border-color 0.15s ease-in-out;
      }
      
      .search-input:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
      }
      
      .btn-search, .btn-reset {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        font-weight: 400;
        border: 1px solid;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.15s ease-in-out;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }
      
      .btn-search {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }
      
      .btn-search:hover {
        background: #0056b3;
        border-color: #0056b3;
      }
      
      .btn-reset {
        background: white;
        color: #6c757d;
        border-color: #6c757d;
      }
      
      .btn-reset:hover {
        background: #6c757d;
        color: white;
      }
      
      .search-result-info {
        margin-top: 1rem;
        padding: 0.75rem;
        background: #e7f1ff;
        border-radius: 4px;
        color: #004085;
        border: 1px solid #b3d7ff;
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="container">
        <div class="navbar-content">
          <a class="navbar-brand" href="/session/list"> Mockerview </a>
          <div class="navbar-nav">
                  <a class="nav-link active" href="/session/list">세션 관리</a>
                  <a class="nav-link" th:if="${currentUser != null}" th:href="@{/auth/mypage}">마이페이지</a>
                  <a class="nav-link" th:if="${currentUser != null}" th:href="@{/auth/logout}">로그아웃</a>
            </div>
            <div th:if="${currentUser == null}">
              <a class="nav-link" th:href="@{/auth/login}">로그인</a>
              <a class="nav-link" th:href="@{/auth/register}">회원가입</a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="page-header">
      <div class="container">
        <div class="page-title">
          <h1>실시간 모의면접 세션</h1>
          <button
            th:if="${currentUser != null and currentUser.role.name() == 'HOST'}"
            class="btn btn-primary"
            onclick="createNewSession()"
          >
            + 새 세션 생성
          </button>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="search-container">
        <form class="search-form" method="get" action="/session/list">
          <input
            type="text"
            id="keyword"
            name="keyword"
            class="search-input"
            placeholder="세션 제목 또는 호스트명으로 검색"
            th:value="${searchDTO?.keyword}"
          />
          <button type="submit" class="btn-search">검색</button>
          <button type="button" class="btn-reset" onclick="resetSearch()">
            초기화
          </button>
        </form>
        
        <div class="search-result-info" th:if="${keyword != null and !#strings.isEmpty(keyword)}">
          "<span th:text="${keyword}">검색어</span>" 검색 결과: <strong th:text="${#lists.size(sessions)}">0</strong>개의 세션
        </div>
      </div>

      <div th:if="${error}" class="alert alert-error">
        <strong>오류:</strong> <span th:text="${error}">에러 메시지</span>
      </div>

      <div th:if="${success}" class="alert alert-success">
        <span th:text="${success}">성공 메시지</span>
      </div>

      <div class="session-grid" th:if="${sessions != null and !sessions.empty}">
        <div th:each="sessionItem : ${sessions}" class="session-card">
          <div class="session-header">
            <div>
              <h3
                class="session-title"
                th:text="${sessionItem.title != null ? sessionItem.title : '모의면접 세션'}"
              >
                모의면접 세션
              </h3>
              <div class="session-meta">
                <span
                  class="badge"
                  th:classappend="${sessionItem.status == 'RUNNING' ? 'badge-live' : (sessionItem.status == 'ENDED' ? 'badge-ended' : 'badge-waiting')}"
                  th:text="${sessionItem.status != null ? sessionItem.status : 'PLANNED'}"
                >PLANNED</span>
              </div>
            </div>
          </div>

          <div class="session-meta" th:if="${sessionItem.host != null}">
            <span>호스트: </span>
            <span th:text="${sessionItem.host.name != null ? sessionItem.host.name : (sessionItem.host.username != null ? sessionItem.host.username : '알 수 없음')}">
              호스트명
            </span>
          </div>

          <div class="session-meta" th:if="${sessionItem.createdAt != null}">
            <span>생성일: </span>
            <span th:text="${#temporals.format(sessionItem.createdAt, 'yyyy-MM-dd HH:mm')}">
              2025-09-23 10:00
            </span>
          </div>

          <div style="margin-top: 1rem">
            <a
              th:if="${currentUser != null and currentUser.role.name() == 'HOST'}"
              th:href="@{/session/{id}/join(id=${sessionItem.id}, role='HOST')}"
              class="btn btn-success"
            >
              면접관으로 참가
            </a>
            <a
              th:if="${currentUser != null and currentUser.role.name() == 'STUDENT'}"
              th:href="@{/session/{id}/join(id=${sessionItem.id}, role='STUDENT')}"
              class="btn btn-primary"
            >
              학생으로 참가
            </a>
            <a
              th:if="${currentUser != null and currentUser.role.name() == 'REVIEWER'}"
              th:href="@{/session/{id}/join(id=${sessionItem.id}, role='REVIEWER')}"
              class="btn btn-info"
            >
              리뷰어로 참가
            </a>
            <div th:if="${currentUser == null}" style="text-align: center; color: #6c757d;">
              로그인 후 참가할 수 있습니다
            </div>
          </div>
        </div>
      </div>

      <div
        th:if="${sessions == null or sessions.empty}"
        style="text-align: center; padding: 4rem 0"
      >
        <h3 style="color: var(--gray-600); margin-bottom: 1rem">
          현재 진행 중인 세션이 없습니다
        </h3>
        <p style="color: var(--gray-500); margin-bottom: 2rem">
          새로운 세션을 생성하거나 기존 세션이 열릴 때까지 기다려주세요.
        </p>

        <div
          class="card"
          style="max-width: 500px; margin: 0 auto; text-align: left"
        >
          <div class="card-body">
            <h4>테스트 세션</h4>
            <p style="color: var(--gray-600); margin: 0.5rem 0">
              개발 테스트용 모의면접 세션입니다.
            </p>
            <a
              href="/session/1/join?role=HOST"
              class="btn btn-success"
              style="margin-right: 8px"
            >면접관으로 테스트</a>
            <a href="/session/1/join?role=STUDENT" class="btn btn-primary">
              학생으로 테스트
            </a>
          </div>
        </div>

        <div style="margin-top: 2rem">
          <button onclick="location.reload()" class="btn btn-secondary">
            새로고침
          </button>
        </div>
      </div>
    </div>

    <div id="sessionModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>새 세션 생성</h2>
          <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
          <form id="createSessionForm">
            <div class="form-group">
              <label for="sessionTitle">세션 제목</label>
              <input
                type="text"
                id="sessionTitle"
                name="title"
                class="form-control"
                placeholder="모의면접 세션 제목"
                required
              />
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">생성하기</button>
              <button type="button" class="btn btn-secondary close-modal">
                취소
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>
  <script>
    function createNewSession() {
      document.getElementById("sessionModal").style.display = "flex";
    }
    
    function resetSearch() {
      window.location.href = '/session/list';
    }
    
    document.addEventListener("DOMContentLoaded", function () {
      const modal = document.getElementById("sessionModal");
      const closeBtns = document.getElementsByClassName("close-modal");

      for (let i = 0; i < closeBtns.length; i++) {
        closeBtns[i].addEventListener("click", function () {
          modal.style.display = "none";
        });
      }

      window.addEventListener("click", function (event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });

      document
        .getElementById("createSessionForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const title = document.getElementById("sessionTitle").value;

          if (title !== null && title.trim() !== "") {
            const form = document.createElement("form");
            form.method = "POST";
            form.action = "/session/create";

            const titleInput = document.createElement("input");
            titleInput.type = "hidden";
            titleInput.name = "title";
            titleInput.value = title.trim();

            form.appendChild(titleInput);
            document.body.appendChild(form);
            form.submit();
          } else {
            alert("세션 제목을 입력해주세요!");
          }
        });
    });
  </script>
</html>