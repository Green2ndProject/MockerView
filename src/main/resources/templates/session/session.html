<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="'Î©¥Ï†ë ÏßÑÌñâ - ' + ${sessionTitle}">Î©¥Ï†ë ÏßÑÌñâ</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.19.0.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #ffffff;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .navbar {
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            padding: 16px 0;
        }
        
        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar-brand {
            font-size: 24px;
            font-weight: 600;
            color: #667eea;
            text-decoration: none;
        }
        
        .navbar-nav {
            display: flex;
            gap: 24px;
            align-items: center;
        }
        
        .nav-link {
            color: #666;
            text-decoration: none;
            font-weight: 500;
        }
        
        .nav-link:hover {
            color: #667eea;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-name {
            color: #333;
            font-weight: 500;
        }
        
        .user-role {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .session-info-bar {
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            padding: 24px 0;
        }
        
        .session-title-section h1 {
            font-size: 28px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }
        
        .session-meta {
            display: flex;
            gap: 16px;
            align-items: center;
            font-size: 14px;
            color: #666;
        }
        
        .badge-live {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .countdown-timer {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
        }
        
        .countdown-timer.warning {
            color: #ff9800;
        }
        
        .countdown-timer.danger {
            color: #ef4444;
        }
        
        .session-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            text-decoration: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #666;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-success {
            background: #667eea;
            color: white;
        }
        
        .btn-success:hover {
            background: #5568d3;
        }
        
        .btn-warning {
            background: #fbbf24;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-end-session {
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-end-session:hover {
            background: #dc2626;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        .btn-lg {
            padding: 14px 28px;
            font-size: 16px;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .expiration-warning {
            background: #fff3cd;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            color: #856404;
        }
        
        .mode-indicator {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .mode-indicator h3 {
            font-size: 24px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .mode-indicator p {
            color: #666;
            margin: 0;
        }
        
        .video-interview-mode,
        .text-interview-mode {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .video-main-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .video-display-area {
            background: #000;
            border-radius: 8px;
            aspect-ratio: 16/9;
            position: relative;
            overflow: hidden;
        }
        
        .video-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 18px;
        }
        
        .local-video-label {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            z-index: 10;
        }
        
        .local-video-label.host {
            background: rgba(239, 68, 68, 0.9);
        }
        
        .local-video-label.student {
            background: rgba(59, 130, 246, 0.9);
        }
        
        .media-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
        }
        
        .media-btn {
            padding: 12px 24px;
            border: 1px solid #fff;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }
        
        .media-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .media-btn.muted,
        .media-btn.off {
            background: #ef4444;
            border-color: #ef4444;
        }
        
        .media-btn.leave {
            background: #ef4444;
            border-color: #ef4444;
        }
        
        .video-controls-panel {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }
        
        .video-controls-panel h4 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
        }
        
        .remote-videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .remote-video-container {
            background: #000;
            border-radius: 6px;
            aspect-ratio: 16/9;
            position: relative;
            overflow: hidden;
        }
        
        .remote-video-label {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 10;
        }
        
        .card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header h3,
        .card-header h4 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .current-question {
            border: 2px solid #667eea;
        }
        
        .current-question .card-header {
            background: #667eea;
            color: white;
            border-bottom: 2px solid #667eea;
        }
        
        .answer-card {
            border: 2px solid #667eea;
        }
        
        .answer-card .card-header {
            background: #667eea;
            color: white;
            border-bottom: 2px solid #667eea;
        }
        
        .question-display {
            background: #f9fafb;
            padding: 24px;
            border-radius: 6px;
            min-height: 120px;
        }
        
        #current-question-text {
            font-size: 18px;
            line-height: 1.6;
            color: #333;
        }
        
        .question-info {
            display: flex;
            gap: 16px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }
        
        .form-control,
        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-control:focus,
        .form-select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .char-counter {
            text-align: right;
            font-size: 13px;
            color: #999;
            margin-top: 4px;
        }
        
        .answer-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .answer-mode-toggle .btn {
            flex: 1;
        }
        
        .answer-mode-toggle .btn.active {
            background: #667eea;
            color: white;
        }
        
        .session-controls {
            margin-bottom: 20px;
        }
        
        .control-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .control-buttons .btn {
            flex: 1;
        }
        
        .session-status-display {
            text-align: center;
            padding: 12px;
            background: #f9fafb;
            border-radius: 6px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .status-badge.waiting {
            background: #e5e7eb;
            color: #666;
        }
        
        .status-badge.ongoing {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-badge.paused {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-badge.ended {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-waiting {
            background: #f3f4f6;
            color: #666;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
        }
        
        .answer-review-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .answer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .user-name-badge {
            background: #f3f4f6;
            color: #333;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .answer-time {
            color: #999;
            font-size: 13px;
        }
        
        .question-text {
            background: #fffbeb;
            border-left: 4px solid #fbbf24;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            color: #92400e;
        }
        
        .answer-text {
            background: #f9fafb;
            border-left: 4px solid #d1d5db;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            color: #4b5563;
        }
        
        .ai-feedback-section {
            background: #eff6ff;
            border-left: 4px solid #667eea;
            padding: 16px;
            border-radius: 6px;
            margin: 16px 0;
        }
        
        .ai-feedback-loading {
            text-align: center;
            color: #667eea;
            font-weight: 500;
        }
        
        .ai-feedback-header {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-score {
            background: #dbeafe;
            color: #667eea;
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-weight: 600;
            text-align: center;
        }
        
        .ai-strengths,
        .ai-improvements {
            margin-bottom: 8px;
            line-height: 1.5;
            color: #1e40af;
        }
        
        .interviewer-evaluation {
            border-top: 1px solid #e5e7eb;
            padding-top: 16px;
            margin-top: 16px;
        }
        
        .evaluation-header h5 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }
        
        .score-input-group,
        .feedback-input-group {
            margin-bottom: 12px;
        }
        
        .score-input-group label,
        .feedback-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }
        
        .score-input {
            width: 100px;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .feedback-textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            resize: vertical;
            font-size: 14px;
            font-family: inherit;
        }
        
        .score-input:focus,
        .feedback-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .evaluation-submit-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
        }
        
        .evaluation-submit-btn:hover {
            background: #5568d3;
        }
        
        .evaluation-submit-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .submitted-evaluation {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            color: #065f46;
            font-size: 14px;
            text-align: center;
        }
        
        .answers-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .scrollable {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .audio-recorder-container {
            text-align: center;
            padding: 40px;
        }

        .interviewer-feedback {
            background: #fffbeb;
            border: 2px solid #fbbf24;
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .interviewer-feedback-title {
            font-weight: 600;
            color: #92400e;
            font-size: 16px;
            margin-bottom: 12px;
        }
        
        .interviewer-name {
            color: #78350f;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .feedback-score {
            margin-bottom: 8px;
            color: #78350f;
        }
        
        .score-badge {
            background: #fbbf24;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
        }
        
        .feedback-comment {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
            color: #1f2937;
            line-height: 1.6;
        }
        
        .text-muted {
            color: #9ca3af;
            font-size: 13px;
            text-align: right;
        }
        
        #recordBtn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            font-size: 32px;
            border: none;
            background:rgb(204, 204, 204);
            color: white;
            cursor: pointer;
        }
        
        #recordingStatus {
            margin-top: 16px;
            color: #666;
            font-weight: 500;
        }
        
        .participant-roles-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .role-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .role-title {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            margin: 0 0 12px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-member {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .role-member:last-child {
            margin-bottom: 0;
        }

        .empty-role {
            color: #999;
            font-size: 14px;
            padding: 10px;
            text-align: center;
        }

        .participant-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .participants-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .participant-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }

        .video-answer-area {
            text-align: center;
            padding: 32px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .answer-complete-message {
            min-height: 120px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            padding: 16px;
            text-align: left;
            margin: 16px 0;
            line-height: 1.6;
            color: #333;
        }

        .answer-status {
            color: #666;
            margin: 16px 0;
            font-weight: 500;
        }

        .answer-status.active {
            color: #ef4444;
        }

        .answer-status.success {
            color: #10b981;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

    @media (max-width: 768px) {
        .container {
            padding: 0 12px;
        }
        
        .navbar-brand {
            font-size: 20px;
        }
        
        .navbar-nav {
            gap: 12px;
        }
        
        .nav-link {
            font-size: 13px;
        }
        
        .user-name {
            display: none; /* Î™®Î∞îÏùºÏóêÏÑú Ïù¥Î¶Ñ Ïà®ÍπÄ */
        }
        
        .session-info-bar {
            padding: 16px 0;
        }
        
        .session-title-section h1 {
            font-size: 22px;
        }
        
        .session-meta {
            flex-wrap: wrap;
            gap: 8px;
            font-size: 12px;
        }
        
        .session-actions {
            flex-direction: column;
            gap: 8px;
        }
        
        .session-actions .btn {
            width: 100%;
        }
        
        .video-main-section {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .video-display-area {
            aspect-ratio: 4/3;
        }
        
        .media-controls {
            bottom: 12px;
            gap: 8px;
            padding: 8px;
        }
        
        .media-btn {
            padding: 10px 18px;
            font-size: 16px;
        }
        
        .remote-videos-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .card {
            margin-bottom: 12px;
        }
        
        .card-header {
            padding: 12px 16px;
        }
        
        .card-header h3,
        .card-header h4 {
            font-size: 16px;
        }
        
        .card-body {
            padding: 16px;
        }
        
        .mode-indicator {
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .mode-indicator h3 {
            font-size: 20px;
        }
        
        .mode-indicator p {
            font-size: 14px;
        }
        
        .form-row {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .control-buttons {
            flex-direction: column;
            gap: 8px;
        }
        
        .control-buttons .btn {
            width: 100%;
        }
        
        .answer-mode-toggle {
            flex-direction: column;
        }
        
        .question-display {
            padding: 16px;
            min-height: 80px;
        }
        
        #current-question-text {
            font-size: 16px;
        }
        
        .participant-roles-section {
            gap: 12px;
        }
        
        .role-group {
            padding: 12px;
        }
        
        .answer-review-card {
            padding: 16px;
        }
        
        .answers-list {
            max-height: 400px;
        }
        
        .video-answer-area {
            padding: 20px;
        }
        
        .btn-lg {
            padding: 12px 20px;
            font-size: 15px;
        }
        
        #recordBtn {
            width: 80px;
            height: 80px;
            font-size: 28px;
        }
        
        .audio-recorder-container {
            padding: 24px;
        }
    }

    @media (max-width: 480px) {
        .navbar {
            padding: 12px 0;
        }
        
        .navbar-brand {
            font-size: 18px;
        }
        
        .navbar-nav {
            gap: 8px;
        }
        
        .nav-link {
            font-size: 12px;
        }
        
        .user-role {
            padding: 3px 8px;
            font-size: 11px;
        }
        
        .session-title-section h1 {
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .session-meta {
            font-size: 11px;
            gap: 6px;
        }
        
        .badge-live {
            padding: 3px 8px;
            font-size: 11px;
        }
        
        .countdown-timer {
            font-size: 14px;
        }
        
        .btn {
            padding: 8px 14px;
            font-size: 13px;
        }
        
        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
        }
        
        .btn-end-session {
            padding: 8px 14px;
            font-size: 13px;
        }
        
        .mode-indicator {
            padding: 12px;
        }
        
        .mode-indicator h3 {
            font-size: 18px;
        }
        
        .mode-indicator p {
            font-size: 13px;
        }
        
        .video-display-area {
            aspect-ratio: 3/4;
        }
        
        .local-video-label {
            top: 8px;
            left: 8px;
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .media-controls {
            bottom: 8px;
            gap: 6px;
            padding: 6px;
        }
        
        .media-btn {
            padding: 8px 14px;
            font-size: 14px;
        }
        
        .remote-videos-grid {
            grid-template-columns: 1fr;
        }
        
        .card-header {
            padding: 10px 12px;
        }
        
        .card-header h3,
        .card-header h4 {
            font-size: 15px;
        }
        
        .card-body {
            padding: 12px;
        }
        
        .question-display {
            padding: 12px;
        }
        
        #current-question-text {
            font-size: 15px;
        }
        
        .form-control,
        .form-select {
            padding: 8px 10px;
            font-size: 13px;
        }
        
        textarea.form-control {
            min-height: 80px;
        }
        
        .form-label {
            font-size: 13px;
        }
        
        .participant-avatar {
            width: 32px;
            height: 32px;
            font-size: 14px;
        }
        
        .role-title {
            font-size: 12px;
        }
        
        .role-member,
        .participant-item {
            padding: 8px;
            font-size: 14px;
        }
        
        .answer-review-card {
            padding: 12px;
        }
        
        .user-name-badge {
            font-size: 13px;
            padding: 3px 10px;
        }
        
        .question-text,
        .answer-text {
            padding: 10px;
            font-size: 14px;
        }
        
        .ai-feedback-section {
            padding: 12px;
            font-size: 14px;
        }
        
        .btn-lg {
            padding: 10px 16px;
            font-size: 14px;
        }
        
        #recordBtn {
            width: 70px;
            height: 70px;
            font-size: 24px;
        }
        
        .status-badge {
            padding: 4px 12px;
            font-size: 12px;
        }
        
        .badge-waiting {
            padding: 3px 8px;
            font-size: 11px;
        }
        
        .empty-state {
            padding: 24px;
            font-size: 14px;
        }
    }

    @media (max-height: 500px) and (orientation: landscape) {
        .video-display-area {
            aspect-ratio: 16/9;
        }
        
        .card {
            margin-bottom: 8px;
        }
        
        .mode-indicator {
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .question-display {
            min-height: 60px;
        }
    }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a class="navbar-brand" href="/session/list">Mockerview</a>
                <div class="navbar-nav">
                    <a class="nav-link" th:href="@{/session/list}">ÏÑ∏ÏÖò Î™©Î°ù</a>
                    <div class="user-info">
                        <span class="user-name" th:text="${userName}">ÏÇ¨Ïö©Ïûê</span>
                        <span class="user-role" th:text="${isHost} ? 'üéØ Î©¥Ï†ëÍ¥Ä' : 'üéì ÏßÄÏõêÏûê'">Ïó≠Ìï†</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="session-info-bar">
        <div class="container">
            <div class="session-title-section">
                <h1 th:text="${sessionTitle}">Î©¥Ï†ë ÏÑ∏ÏÖò</h1>
                <div class="session-meta">
                    <span class="timer">
                        <span id="session-timer">00:00</span>
                    </span>
                    <span id="countdown-display" class="countdown-timer"></span>
                    <span class="badge-live">ÏßÑÌñâ Ï§ë</span>
                    <span id="session-stats">ÏßàÎ¨∏ 0Í∞ú ‚Ä¢ ÎãµÎ≥Ä 0Í∞ú</span>
                </div>
            </div>
            <div class="session-actions">
                <button th:if="${isHost}" id="endSessionBtn" class="btn-end-session" onclick="endSessionManually()">
                    üõë ÏÑ∏ÏÖò Ï¢ÖÎ£å
                </button>
                <a th:href="@{/session/scoreboard/{id}(id=${sessionId})}" class="btn btn-secondary btn-sm">
                    Ï†êÏàòÌåê
                </a>
                <a th:href="@{/session/detail/{id}(id=${sessionId})}" class="btn btn-primary btn-sm">
                    ÏÉÅÏÑ∏ Í≤∞Í≥º
                </a>
            </div>
        </div>
    </div>

    <div id="expiration-warning" class="container" style="display: none;">
        <div class="expiration-warning">
            ‚ö†Ô∏è ÏÑ∏ÏÖòÏù¥ 5Î∂Ñ ÌõÑ ÏûêÎèô Ï¢ÖÎ£åÎê©ÎãàÎã§!
        </div>
    </div>

    <div th:if="${sessionType == 'VIDEO'}" class="video-interview-mode container">
        <div class="mode-indicator">
            <h3>üìπ ÌôîÏÉÅ Î©¥Ï†ë Î™®Îìú</h3>
            <p>ÌôîÏÉÅÏúºÎ°ú Î©¥Ï†ëÏùÑ ÏßÑÌñâÌï©ÎãàÎã§</p>
        </div>

        <div class="video-main-section">
            <div class="video-display-area" id="videoDisplayArea">
                <div id="local-video" style="width: 100%; height: 100%; position: relative;">
                    <div th:class="${isHost} ? 'local-video-label host' : 'local-video-label student'">
                        <span th:text="${userName}">ÎÇò</span>
                    </div>
                    <div class="video-placeholder">
                        <span>üìπ ÌôîÏÉÅ Ïó∞Í≤∞ Ï§ë...</span>
                    </div>
                </div>
                <div class="media-controls">
                    <button id="audioBtn" class="media-btn audio" onclick="toggleAudio()">üé§</button>
                    <button id="videoBtn" class="media-btn video" onclick="toggleVideo()">üìπ</button>
                    <button class="media-btn leave" onclick="stopMedia()">üìû Ï¢ÖÎ£å</button>
                </div>
            </div>

            <div class="video-controls-panel">
                <h4>Ï∞∏Í∞ÄÏûê</h4>
                <div id="remote-videos" class="remote-videos-grid"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h4>üë• Ï∞∏Í∞ÄÏûê</h4>
                <span id="participant-count" class="badge-waiting">0Î™Ö</span>
            </div>
            <div class="card-body">
                <div class="participant-roles-section">
                    <div class="role-group">
                        <h5 class="role-title">üé§ Î©¥Ï†ëÍ¥Ä</h5>
                        <div class="role-member" th:if="${sessionHost != null}">
                            <div class="participant-avatar" th:text="${#strings.substring(sessionHost.name, 0, 1)}"></div>
                            <span th:text="${sessionHost.name}"></span>
                            <span style="font-size: 12px; color: #667eea; margin-left: 8px;">Ìò∏Ïä§Ìä∏</span>
                        </div>
                        <div class="empty-role" th:if="${sessionHost == null}">Î∞∞Ï†ïÎêú Î©¥Ï†ëÍ¥Ä ÏóÜÏùå</div>
                    </div>
                    
                    <div class="role-group">
                        <h5 class="role-title">üíº Î©¥Ï†ëÏûê</h5>
                        <div id="participants-list" class="participants-list">
                            <div class="empty-state">ÎåÄÍ∏∞ Ï§ë...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${isHost}" class="host-view">
            <div class="card session-controls">
                <div class="card-header">
                    <h4>Î©¥Ï†ë Ï†úÏñ¥</h4>
                </div>
                <div class="card-body">
                    <div class="control-buttons">
                        <button id="startInterviewBtn" onclick="startInterview()" class="btn btn-success">Î©¥Ï†ë ÏãúÏûë</button>
                        <button id="pauseInterviewBtn" onclick="pauseInterview()" class="btn btn-warning" style="display: none;">ÏùºÏãúÏ†ïÏßÄ</button>
                        <button id="endInterviewBtn" onclick="endInterview()" class="btn btn-danger" style="display: none;">Î©¥Ï†ë Ï¢ÖÎ£å</button>
                    </div>
                    <div class="session-status-display">
                        <span class="status-badge waiting" id="sessionStatusBadge">ÎåÄÍ∏∞Ï§ë</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h4>ÏßàÎ¨∏ Ï∂úÏ†ú</h4>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">ÏßàÎ¨∏ ÎÇ¥Ïö©</label>
                        <textarea id="newQuestionText" placeholder="Î©¥Ï†ë ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ÏàúÏÑú</label>
                            <input type="number" id="newQuestionOrder" value="1" min="1" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÎãµÎ≥ÄÏãúÍ∞Ñ</label>
                            <select id="newTimerOrder" class="form-select">
                                <option value="30">30Ï¥à</option>
                                <option value="60" selected>1Î∂Ñ</option>
                                <option value="90">1Î∂Ñ 30Ï¥à</option>
                                <option value="120">2Î∂Ñ</option>
                                <option value="180">3Î∂Ñ</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="window.sendQuestion()" class="btn btn-primary btn-full">ÏßàÎ¨∏ Ï∂úÏ†ú</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h4>Ï†úÏ∂úÎêú ÎãµÎ≥Ä Î∞è ÌèâÍ∞Ä</h4>
                    <span id="answer-count" class="badge-waiting">0Í∞ú</span>
                </div>
                <div class="card-body">
                    <div id="answers-list" class="answers-list">
                        <div class="empty-state">
                            <p>ÏïÑÏßÅ Ï†úÏ∂úÎêú ÎãµÎ≥ÄÏù¥ ÏóÜÏäµÎãàÎã§</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:unless="${isHost}" class="student-view">
            <div class="card current-question">
                <div class="card-header">
                    <h3>ÌòÑÏû¨ ÏßàÎ¨∏</h3>
                    <div class="question-info">
                        <span id="question-number">Q1</span>
                        <span id="question-timer">‚è±Ô∏è 00:00</span>
                    </div>
                </div>
                <div class="card-body">
                    <div id="current-question" class="question-display">
                        <p id="current-question-text">Î©¥Ï†ëÍ¥ÄÏù¥ ÏßàÎ¨∏ÏùÑ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§...</p>
                    </div>
                    <input type="hidden" id="currentQuestionId" value="">
                </div>
            </div>
        
            <div class="card answer-card">
                <div class="card-header">
                    <h4>ÎãµÎ≥Ä ÏûëÏÑ±</h4>
                    <span style="font-size: 14px; font-weight: normal;">ÌôîÏÉÅÏúºÎ°ú Íµ¨Îëê ÎãµÎ≥ÄÌïòÍ±∞ÎÇò ÌÖçÏä§Ìä∏Î°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî</span>
                </div>
                <div class="card-body">
                    <div class="answer-mode-toggle">
                        <button id="videoAnswerModeBtn" class="btn btn-secondary active" onclick="switchVideoAnswerMode('video')">üé• Íµ¨Îëê ÎãµÎ≥Ä</button>
                        <button id="textAnswerModeBtn" class="btn btn-secondary" onclick="switchVideoAnswerMode('text')">üí¨ ÌÖçÏä§Ìä∏ ÎãµÎ≥Ä</button>
                    </div>
        
                    <div id="video-answer-area" class="video-answer-area">
                        <div style="margin-bottom: 16px;">
                            <button id="startVideoRecognitionBtn" onclick="startVideoSpeechRecognition()" class="btn btn-success btn-lg">
                                üé§ ÏùåÏÑ± Ïù∏Ïãù ÏãúÏûë
                            </button>
                        </div>
                        <div id="videoRecognitionStatus" class="answer-status">
                            ÌôîÏÉÅÏúºÎ°ú ÎãµÎ≥ÄÌïòÏãúÎ©¥ÏÑú ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî
                        </div>
                        <div id="videoRecognizedText" class="answer-complete-message">
                            <em style="color: #999;">Ïù∏ÏãùÎêú ÎãµÎ≥Ä ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§...</em>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button id="submitVideoRecognizedBtn" onclick="submitVideoRecognizedAnswer()" class="btn btn-success btn-lg" style="display: none; flex: 1;">
                                ‚úÖ ÏùåÏÑ±Ïù∏Ïãù ÎãµÎ≥Ä Ï†úÏ∂ú
                            </button>
                            <button id="submitVideoDirectBtn" onclick="submitVideoDirectAnswer()" class="btn btn-primary btn-lg" style="flex: 1;">
                                üìπ ÌôîÏÉÅ ÎãµÎ≥Ä Ï†úÏ∂ú (ÌÖçÏä§Ìä∏ ÏóÜÏù¥)
                            </button>
                        </div>
                    </div>
        
                    <div id="text-answer-area" style="display: none;">
                        <div class="form-group">
                            <textarea id="answerText" placeholder="Ïó¨Í∏∞Ïóê ÎãµÎ≥ÄÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî..." class="form-control" rows="5"></textarea>
                            <div class="char-counter">
                                <span id="charCount">0</span>/1000Ïûê
                            </div>
                        </div>
                        <button onclick="window.submitAnswer()" class="btn btn-success btn-full">ÎãµÎ≥Ä Ï†úÏ∂ú</button>
                    </div>
                </div>
            </div>
        
            <div class="card">
                <div class="card-header">
                    <h4>ü§ñ AI ÌîºÎìúÎ∞±</h4>
                    <span style="font-size: 14px; font-weight: normal; color: #667eea;">Ïã§ÏãúÍ∞Ñ Î∂ÑÏÑù</span>
                </div>
                <div class="card-body">
                    <div id="ai-feedback-list" class="feedback-list scrollable">
                        <div class="empty-state">
                            <div>ü§ñ</div>
                            <p>ÎãµÎ≥ÄÏù¥ Ï†úÏ∂úÎêòÎ©¥ AIÍ∞Ä Ï¶âÏãú Î∂ÑÏÑùÌï©ÎãàÎã§</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:unless="${sessionType == 'VIDEO'}" class="text-interview-mode container">
        <div class="mode-indicator">
            <h3 th:text="${sessionType == 'AUDIO' ? 'üé§ ÏùåÏÑ± Î©¥Ï†ë Î™®Îìú' : 'üí¨ ÌÖçÏä§Ìä∏ Î©¥Ï†ë Î™®Îìú'}">Î©¥Ï†ë Î™®Îìú</h3>
            <p th:text="${sessionType == 'AUDIO' ? 'ÌÖçÏä§Ìä∏ ÎòêÎäî ÏùåÏÑ±ÏúºÎ°ú ÎãµÎ≥ÄÌï† Ïàò ÏûàÏäµÎãàÎã§' : 'ÌÖçÏä§Ìä∏Î°ú ÎãµÎ≥ÄÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî'}">Î™®Îìú ÏÑ§Î™Ö</p>
        </div>

        <div class="card">
            <div class="card-header">
                <h4>üë• Ï∞∏Í∞ÄÏûê</h4>
                <span id="participant-count" class="badge-waiting">0Î™Ö</span>
            </div>
            <div class="card-body">
                <div class="participant-roles-section">
                    <div class="role-group">
                        <h5 class="role-title">üé§ Î©¥Ï†ëÍ¥Ä</h5>
                        <div class="role-member" th:if="${sessionHost != null}">
                            <div class="participant-avatar" th:text="${#strings.substring(sessionHost.name, 0, 1)}"></div>
                            <span th:text="${sessionHost.name}"></span>
                        </div>
                        <div class="empty-role" th:if="${sessionHost == null}">Î∞∞Ï†ïÎêú Î©¥Ï†ëÍ¥Ä ÏóÜÏùå</div>
                    </div>
                    
                    <div class="role-group">
                        <h5 class="role-title">üíº Î©¥Ï†ëÏûê</h5>
                        <div id="participants-list" class="participants-list">
                            <div class="empty-state">ÎåÄÍ∏∞ Ï§ë...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="interview-layout">
            <div th:if="${isHost}" class="host-view">
                <div class="card session-controls">
                    <div class="card-header">
                        <h4>Î©¥Ï†ë Ï†úÏñ¥</h4>
                    </div>
                    <div class="card-body">
                        <div class="control-buttons">
                            <button id="startInterviewBtn" onclick="startInterview()" class="btn btn-success">Î©¥Ï†ë ÏãúÏûë</button>
                            <button id="pauseInterviewBtn" onclick="pauseInterview()" class="btn btn-warning" style="display: none;">ÏùºÏãúÏ†ïÏßÄ</button>
                            <button id="endInterviewBtn" onclick="endInterview()" class="btn btn-danger" style="display: none;">Î©¥Ï†ë Ï¢ÖÎ£å</button>
                        </div>
                        <div class="session-status-display">
                            <span class="status-badge waiting" id="sessionStatusBadge">ÎåÄÍ∏∞Ï§ë</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4>ÏßàÎ¨∏ Ï∂úÏ†ú</h4>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">ÏßàÎ¨∏ ÎÇ¥Ïö©</label>
                            <textarea id="newQuestionText" placeholder="Î©¥Ï†ë ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ÏàúÏÑú</label>
                                <input type="number" id="newQuestionOrder" value="1" min="1" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÎãµÎ≥ÄÏãúÍ∞Ñ</label>
                                <select id="newTimerOrder" class="form-select">
                                    <option value="30">30Ï¥à</option>
                                    <option value="60" selected>1Î∂Ñ</option>
                                    <option value="90">1Î∂Ñ 30Ï¥à</option>
                                    <option value="120">2Î∂Ñ</option>
                                    <option value="180">3Î∂Ñ</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="window.sendQuestion()" class="btn btn-primary btn-full">ÏßàÎ¨∏ Ï∂úÏ†ú</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4>Ï†úÏ∂úÎêú ÎãµÎ≥Ä Î∞è ÌèâÍ∞Ä</h4>
                        <span id="answer-count" class="badge-waiting">0Í∞ú</span>
                    </div>
                    <div class="card-body">
                        <div id="answers-list" class="answers-list">
                            <div class="empty-state">
                                <p>ÏïÑÏßÅ Ï†úÏ∂úÎêú ÎãµÎ≥ÄÏù¥ ÏóÜÏäµÎãàÎã§</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div th:unless="${isHost}" class="student-view">
                <div class="card current-question">
                    <div class="card-header">
                        <h3>ÌòÑÏû¨ ÏßàÎ¨∏</h3>
                        <div class="question-info">
                            <span id="question-number">Q1</span>
                            <span id="question-timer">‚è±Ô∏è 00:00</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="current-question" class="question-display">
                            <p id="current-question-text">Î©¥Ï†ëÍ¥ÄÏù¥ ÏßàÎ¨∏ÏùÑ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§...</p>
                        </div>
                        <input type="hidden" id="currentQuestionId" value="">
                    </div>
                </div>

                <div class="card answer-card">
                    <div class="card-header">
                        <h4>ÎãµÎ≥Ä ÏûëÏÑ±</h4>
                        <span style="font-size: 14px; font-weight: normal;">Ï∞®Î∂ÑÌûà ÏÉùÍ∞ÅÌïòÍ≥† ÎãµÎ≥ÄÌï¥Î≥¥ÏÑ∏Ïöî</span>
                    </div>
                    <div class="card-body">
                        <div class="answer-mode-toggle" th:if="${sessionType == 'AUDIO'}">
                            <button id="textModeBtn" class="btn btn-secondary active" onclick="switchAnswerMode('text')">üí¨ ÌÖçÏä§Ìä∏</button>
                            <button id="voiceModeBtn" class="btn btn-secondary" onclick="switchAnswerMode('voice')">üé§ ÏùåÏÑ±</button>
                        </div>
                
                        <div id="text-answer-area">
                            <div class="form-group">
                                <textarea id="answerText" placeholder="Ïó¨Í∏∞Ïóê ÎãµÎ≥ÄÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî..." class="form-control" rows="5"></textarea>
                                <div class="char-counter">
                                    <span id="charCount">0</span>/1000Ïûê
                                </div>
                            </div>
                            <button onclick="window.submitAnswer()" class="btn btn-success btn-full">ÎãµÎ≥Ä Ï†úÏ∂ú</button>
                        </div>
                
                        <div id="voice-answer-area" style="display: none;" th:if="${sessionType == 'AUDIO'}">
                            <div class="audio-recorder-container">
                                <button id="recordBtn" onclick="toggleRecording()">üé§</button>
                                <div id="recordingStatus">ÎÖπÏùå ÏãúÏûëÌïòÎ†§Î©¥ ÌÅ¥Î¶≠</div>
                            </div>
                            <button id="submitVoiceBtn" onclick="submitVoiceAnswer()" class="btn btn-success btn-lg btn-full" style="margin-top: 16px; display: none;">ÎãµÎ≥Ä Ï†úÏ∂ú</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4>ü§ñ AI ÌîºÎìúÎ∞±</h4>
                        <span style="font-size: 14px; font-weight: normal; color: #667eea;">Ïã§ÏãúÍ∞Ñ Î∂ÑÏÑù</span>
                    </div>
                    <div class="card-body">
                        <div id="ai-feedback-list" class="feedback-list scrollable">
                            <div class="empty-state">
                                <div>ü§ñ</div>
                                <p>ÎãµÎ≥ÄÏù¥ Ï†úÏ∂úÎêòÎ©¥ AIÍ∞Ä Ï¶âÏãú Î∂ÑÏÑùÌï©ÎãàÎã§</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.19.0.js"></script>
    <script th:src="@{/js/agora-client.js}"></script>
    <script th:src="@{/js/mockerview-websocket.js}"></script>
    <script th:inline="javascript">
        const SESSION_DATA = {
            sessionId: /*[[${sessionId}]]*/ 1,
            userId: /*[[${userId}]]*/ 1,
            userName: /*[[${userName}]]*/ 'ÏÇ¨Ïö©Ïûê',
            isHost: /*[[${isHost}]]*/ false,
            sessionType: /*[[${sessionType}]]*/ 'TEXT',
            expiresAt: /*[[${session.expiresAt}]]*/ null
        };
        
        let countdownInterval = null;
        let warningShown = false;
        let agoraClient = null;
        let mediaEnabled = false;
        let mediaInitialized = false;
        let interviewStatus = 'waiting';
        let currentAnswerMode = 'text';
        let audioRecorder = null;
        let audioBlob = null;
        let audioChunks = [];
        let answerCount = 0;
        let videoRecognition = null;
        let videoRecognizedFullText = '';
        
        function getToken() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'Authorization') {
                    return value;
                }
            }
            return '';
        }
        
        async function initializeMedia() {
            if (mediaInitialized) {
                console.log('‚ö†Ô∏è Ïù¥ÎØ∏ ÎØ∏ÎîîÏñ¥ Ï¥àÍ∏∞ÌôîÎê® - Ï§ëÎ≥µ Ìò∏Ï∂ú Î∞©ÏßÄ');
                return;
            }
            
            if (SESSION_DATA.sessionType !== 'VIDEO' && SESSION_DATA.sessionType !== 'AUDIO') {
                console.log('‚ùå ÎØ∏ÎîîÏñ¥ ÌÉÄÏûÖÏù¥ ÏïÑÎãò:', SESSION_DATA.sessionType);
                return;
            }
            
            console.log('üé¨ ÎØ∏ÎîîÏñ¥ Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
            
            if (typeof AgoraRTC === 'undefined') {
                console.error('‚ùå AgoraRTC SDKÍ∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§');
                alert('ÌôîÏÉÅ Ïó∞Í≤∞ SDK Î°úÎî© Ïã§Ìå®');
                return;
            }
            
            if (typeof AgoraClient === 'undefined') {
                console.error('‚ùå AgoraClient ÌÅ¥ÎûòÏä§Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§');
                alert('ÌôîÏÉÅ Ïó∞Í≤∞ Î™®Îìà Î°úÎî© Ïã§Ìå®');
                return;
            }
            
            try {
                console.log('1Ô∏è‚É£ JWT ÌÜ†ÌÅ∞ Í∞ÄÏ†∏Ïò§Í∏∞...');
                const token = getToken();
                if (!token) {
                    throw new Error('JWT ÌÜ†ÌÅ∞Ïù¥ ÏóÜÏäµÎãàÎã§');
                }
                
                console.log('2Ô∏è‚É£ Agora ÌÜ†ÌÅ∞ ÏöîÏ≤≠...');
                const response = await fetch(`/api/agora/token/${SESSION_DATA.sessionId}`, {
                    method: 'POST',
                    headers: { 'Authorization': token }
                });
                
                if (!response.ok) {
                    throw new Error('Agora ÌÜ†ÌÅ∞ Î∞úÍ∏â Ïã§Ìå®: ' + response.status);
                }
                
                const tokenData = await response.json();
                console.log('3Ô∏è‚É£ Agora ÌÜ†ÌÅ∞ Îç∞Ïù¥ÌÑ∞:', tokenData);
                
                if (agoraClient) {
                    console.log('üßπ Í∏∞Ï°¥ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï†ïÎ¶¨...');
                    await agoraClient.leave();
                    agoraClient = null;
                }
                
                console.log('4Ô∏è‚É£ AgoraClient ÏÉùÏÑ±...');
                agoraClient = new AgoraClient(tokenData.appId);
                console.log('‚úÖ AgoraClient ÏÉùÏÑ± ÏôÑÎ£å');
                
                console.log('5Ô∏è‚É£ Ï±ÑÎÑê Ï∞∏Í∞Ä ÏãúÎèÑ...');
                await agoraClient.join(tokenData.channel, tokenData.token, tokenData.uid);
                console.log('‚úÖ Ï±ÑÎÑê Ï∞∏Í∞Ä ÏÑ±Í≥µ!');
                
                const placeholder = document.querySelector('.video-placeholder');
                if (placeholder) {
                    placeholder.remove();
                    console.log('‚úÖ Placeholder Ï†úÍ±∞Îê®');
                }
                
                console.log('6Ô∏è‚É£ ÎØ∏ÎîîÏñ¥ Î∞úÌñâ ÏãúÎèÑ...');
                if (SESSION_DATA.sessionType === 'VIDEO') {
                    await agoraClient.publishAudioVideo();
                    console.log('‚úÖ ÎπÑÎîîÏò§ Î∞úÌñâ ÏôÑÎ£å');
                } else {
                    await agoraClient.publishAudioOnly();
                    console.log('‚úÖ Ïò§ÎîîÏò§ Î∞úÌñâ ÏôÑÎ£å');
                }
                
                mediaEnabled = true;
                mediaInitialized = true;
                console.log('üéâ ÎØ∏ÎîîÏñ¥ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!');
                
            } catch (error) {
                console.error('üí• ÎØ∏ÎîîÏñ¥ Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                console.error('  - Ïò§Î•ò ÏΩîÎìú:', error.code);
                console.error('  - Ïò§Î•ò Î©îÏãúÏßÄ:', error.message);
                
                if (agoraClient) {
                    await agoraClient.leave();
                    agoraClient = null;
                }
                mediaInitialized = false;
                
                alert('ÌôîÏÉÅ/ÏùåÏÑ± Ïó∞Í≤∞ Ïã§Ìå®:\n' + error.message);
            }
        }
        
        async function stopMedia() {
            console.log('üõë ÎØ∏ÎîîÏñ¥ Ï§ëÏßÄ ÏöîÏ≤≠...');
            if (agoraClient) {
                await agoraClient.leave();
                agoraClient = null;
            }
            mediaEnabled = false;
            console.log('‚úÖ ÎØ∏ÎîîÏñ¥ Ï§ëÏßÄ ÏôÑÎ£å');
        }
        
        function toggleAudio() {
            if (agoraClient) {
                const enabled = agoraClient.toggleAudio();
                const btn = document.getElementById('audioBtn');
                btn.classList.toggle('muted', !enabled);
                btn.innerHTML = enabled ? 'üé§' : 'üîá';
            }
        }
        
        function toggleVideo() {
            if (agoraClient && SESSION_DATA.sessionType === 'VIDEO') {
                const enabled = agoraClient.toggleVideo();
                const btn = document.getElementById('videoBtn');
                btn.classList.toggle('off', !enabled);
                btn.innerHTML = enabled ? 'üìπ' : 'üö´';
            }
        }
        
        function startCountdown() {
            if (!SESSION_DATA.expiresAt) return;
            const expiresAt = new Date(SESSION_DATA.expiresAt).getTime();
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const remaining = expiresAt - now;
                if (remaining <= 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown-display').textContent = 'ÎßåÎ£åÎê®';
                    document.getElementById('countdown-display').className = 'countdown-timer danger';
                    return;
                }
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                document.getElementById('countdown-display').textContent = 
                    `ÎÇ®ÏùÄ ÏãúÍ∞Ñ: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                if (remaining <= 5 * 60 * 1000) {
                    document.getElementById('countdown-display').className = 'countdown-timer warning';
                    if (!warningShown) {
                        document.getElementById('expiration-warning').style.display = 'block';
                        warningShown = true;
                    }
                }
                if (remaining <= 1 * 60 * 1000) {
                    document.getElementById('countdown-display').className = 'countdown-timer danger';
                }
            }, 1000);
        }
        
        async function endSessionManually() {
            if (!confirm('Ï†ïÎßêÎ°ú ÏÑ∏ÏÖòÏùÑ Ï¢ÖÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            try {
                const token = getToken();
                const response = await fetch(`/api/session/${SESSION_DATA.sessionId}/end`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token
                    }
                });
                const data = await response.json();
                if (data.success) {
                    alert('ÏÑ∏ÏÖòÏù¥ Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§');
                    window.location.href = '/session/list';
                } else {
                    alert(data.message || 'ÏÑ∏ÏÖò Ï¢ÖÎ£åÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§');
                }
            } catch (error) {
                console.error('ÏÑ∏ÏÖò Ï¢ÖÎ£å Ïò§Î•ò:', error);
                alert('ÏÑ∏ÏÖò Ï¢ÖÎ£å Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
            }
        }
        
        const answerTextArea = document.getElementById('answerText');
        if (answerTextArea) {
            answerTextArea.addEventListener('input', function() {
                const count = this.value.length;
                document.getElementById('charCount').textContent = count;
                if (count > 1000) {
                    this.value = this.value.substring(0, 1000);
                    document.getElementById('charCount').textContent = 1000;
                }
            });
        }
        
        window.startInterview = async function() {
            if (confirm('Î©¥Ï†ëÏùÑ ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                try {
                    const token = getToken();
                    const response = await fetch(`/api/session/${SESSION_DATA.sessionId}/start`, {
                        method: 'POST',
                        headers: {
                            'Authorization': token,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (result.status === 'success') {
                        if (window.mockerViewWS && window.mockerViewWS.connected) {
                            window.mockerViewWS.sendControlMessage('START');
                        }
                        
                        document.getElementById('startInterviewBtn').style.display = 'none';
                        document.getElementById('pauseInterviewBtn').style.display = 'inline-block';
                        document.getElementById('endInterviewBtn').style.display = 'inline-block';
                        
                        const badge = document.getElementById('sessionStatusBadge');
                        if (badge) {
                            badge.textContent = 'ÏßÑÌñâÏ§ë';
                            badge.className = 'status-badge ongoing';
                        }
                        
                        alert('‚úÖ Î©¥Ï†ëÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§!');
                    } else {
                        alert('‚ùå Î©¥Ï†ë ÏãúÏûë Ïã§Ìå®: ' + result.message);
                    }
                } catch (error) {
                    console.error('‚ùå Î©¥Ï†ë ÏãúÏûë Ïò§Î•ò:', error);
                    alert('Î©¥Ï†ë ÏãúÏûë Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            }
        };
        
        window.pauseInterview = function() {
            if (confirm('Î©¥Ï†ëÏùÑ ÏùºÏãúÏ†ïÏßÄÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                if (window.mockerViewWS && window.mockerViewWS.connected) {
                    window.mockerViewWS.sendControlMessage('PAUSE');
                    document.getElementById('pauseInterviewBtn').textContent = 'Ïû¨Í∞ú';
                    document.getElementById('pauseInterviewBtn').onclick = window.resumeInterview;
                }
            }
        };
        
        window.resumeInterview = function() {
            if (window.mockerViewWS && window.mockerViewWS.connected) {
                window.mockerViewWS.sendControlMessage('RESUME');
                document.getElementById('pauseInterviewBtn').textContent = 'ÏùºÏãúÏ†ïÏßÄ';
                document.getElementById('pauseInterviewBtn').onclick = window.pauseInterview;
            }
        };
        
        window.endInterview = function() {
            if (confirm('Î©¥Ï†ëÏùÑ Ï¢ÖÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏ¢ÖÎ£å ÌõÑÏóêÎäî ÎãµÎ≥ÄÏùÑ Ï†úÏ∂úÌï† Ïàò ÏóÜÏäµÎãàÎã§.')) {
                if (window.mockerViewWS && window.mockerViewWS.connected) {
                    window.mockerViewWS.sendControlMessage('END');
                    document.getElementById('pauseInterviewBtn').style.display = 'none';
                    document.getElementById('endInterviewBtn').style.display = 'none';
                    alert('Î©¥Ï†ëÏù¥ Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§.');
                    setTimeout(function() {
                        window.location.href = "/session/detail/" + SESSION_DATA.sessionId;
                    }, 2000);
                }
            }
        };
        
        function switchVideoAnswerMode(mode) {
            if (mode === 'video') {
                document.getElementById('videoAnswerModeBtn').classList.add('active');
                document.getElementById('textAnswerModeBtn').classList.remove('active');
                document.getElementById('video-answer-area').style.display = 'block';
                document.getElementById('text-answer-area').style.display = 'none';
            } else {
                document.getElementById('videoAnswerModeBtn').classList.remove('active');
                document.getElementById('textAnswerModeBtn').classList.add('active');
                document.getElementById('video-answer-area').style.display = 'none';
                document.getElementById('text-answer-area').style.display = 'block';
            }
        }
        
        function startVideoSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§. ChromeÏùÑ ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
        
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            videoRecognition = new SpeechRecognition();
            videoRecognition.lang = 'ko-KR';
            videoRecognition.continuous = true;
            videoRecognition.interimResults = true;
        
            const statusDiv = document.getElementById('videoRecognitionStatus');
            const textDiv = document.getElementById('videoRecognizedText');
            const submitBtn = document.getElementById('submitVideoRecognizedBtn');
            const startBtn = document.getElementById('startVideoRecognitionBtn');
        
            videoRecognizedFullText = '';
        
            videoRecognition.onstart = function() {
                statusDiv.textContent = 'üé§ ÏùåÏÑ± Ïù∏Ïãù Ï§ë... ÌôîÏÉÅÏúºÎ°ú ÎãµÎ≥ÄÌï¥Ï£ºÏÑ∏Ïöî';
                statusDiv.className = 'answer-status active';
                startBtn.textContent = '‚èπÔ∏è Ïù∏Ïãù Ï§ëÏßÄ';
                startBtn.onclick = stopVideoSpeechRecognition;
                submitBtn.style.display = 'none';
            };
        
            videoRecognition.onresult = function(event) {
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        videoRecognizedFullText += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                textDiv.innerHTML = videoRecognizedFullText + '<span style="color: #999;">' + interimTranscript + '</span>';
            };
        
            videoRecognition.onerror = function(event) {
                console.error('ÏùåÏÑ± Ïù∏Ïãù Ïò§Î•ò:', event.error);
                statusDiv.textContent = '‚ùå Ïò§Î•ò: ' + event.error;
                statusDiv.className = 'answer-status';
            };
        
            videoRecognition.onend = function() {
                statusDiv.textContent = '‚úÖ Ïù∏Ïãù ÏôÑÎ£å! Ï†úÏ∂ú Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî';
                statusDiv.className = 'answer-status success';
                startBtn.textContent = 'üé§ ÏùåÏÑ± Ïù∏Ïãù ÏãúÏûë';
                startBtn.onclick = startVideoSpeechRecognition;
                if (videoRecognizedFullText.trim()) {
                    submitBtn.style.display = 'inline-block';
                }
            };
        
            videoRecognition.start();
        }
        
        function submitVideoDirectAnswer() {
            const questionId = document.getElementById('currentQuestionId').value;
            if (!questionId) {
                alert('ÌòÑÏû¨ ÎãµÎ≥ÄÌï† ÏßàÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            if (!confirm('ÌôîÏÉÅÏúºÎ°ú Íµ¨Îëê ÎãµÎ≥ÄÏùÑ ÏôÑÎ£åÌïòÏÖ®ÎÇòÏöî?\nÌÖçÏä§Ìä∏ ÏóÜÏù¥ ÌôîÏÉÅ ÎãµÎ≥ÄÎßå Ï†úÏ∂úÎê©ÎãàÎã§.')) {
                return;
            }
        
            const defaultText = 'ÌôîÏÉÅ Î©¥Ï†ëÏúºÎ°ú Íµ¨Îëê ÎãµÎ≥ÄÌï®';
            
            if (window.mockerViewWS && window.mockerViewWS.connected) {
                window.mockerViewWS.submitAnswer(questionId, defaultText);
                
                document.getElementById('videoRecognitionStatus').textContent = 'ÎãµÎ≥ÄÏù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§';
                document.getElementById('videoRecognitionStatus').className = 'answer-status success';
                
                alert('ÌôîÏÉÅ ÎãµÎ≥ÄÏù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§!');
            }
        }
        
        function stopVideoSpeechRecognition() {
            if (videoRecognition) {
                videoRecognition.stop();
            }
        }
        
        function submitVideoRecognizedAnswer() {
            const questionId = document.getElementById('currentQuestionId').value;
            if (!videoRecognizedFullText.trim()) {
                alert('Ïù∏ÏãùÎêú ÌÖçÏä§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            if (!questionId) {
                alert('ÌòÑÏû¨ ÎãµÎ≥ÄÌï† ÏßàÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
        
            if (window.mockerViewWS && window.mockerViewWS.connected) {
                window.mockerViewWS.submitAnswer(questionId, videoRecognizedFullText.trim());
                
                const textDiv = document.getElementById('videoRecognizedText');
                textDiv.innerHTML = '<div style="text-align: center; color: #10b981; font-weight: 600;">‚úÖ ÎãµÎ≥ÄÏù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§</div>';
                
                document.getElementById('submitVideoRecognizedBtn').style.display = 'none';
                document.getElementById('videoRecognitionStatus').textContent = 'ÎãµÎ≥ÄÏù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§';
                document.getElementById('videoRecognitionStatus').className = 'answer-status success';
                
                videoRecognizedFullText = '';
                alert('ÎãµÎ≥ÄÏù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§!');
            }
        }
        
        function switchAnswerMode(mode) {
            currentAnswerMode = mode;
            if (mode === 'text') {
                document.getElementById('textModeBtn').classList.add('active');
                const voiceBtn = document.getElementById('voiceModeBtn');
                if (voiceBtn) voiceBtn.classList.remove('active');
                document.getElementById('text-answer-area').style.display = 'block';
                const voiceArea = document.getElementById('voice-answer-area');
                if (voiceArea) voiceArea.style.display = 'none';
            } else {
                const textBtn = document.getElementById('textModeBtn');
                if (textBtn) textBtn.classList.remove('active');
                document.getElementById('voiceModeBtn').classList.add('active');
                document.getElementById('text-answer-area').style.display = 'none';
                document.getElementById('voice-answer-area').style.display = 'block';
            }
        }
        
        async function toggleRecording() {
            const recordBtn = document.getElementById('recordBtn');
            const recordingStatus = document.getElementById('recordingStatus');
            const submitVoiceBtn = document.getElementById('submitVoiceBtn');
            if (!audioRecorder || audioRecorder.state === 'inactive') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    audioRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    audioRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) {
                            audioChunks.push(e.data);
                        }
                    };
                    audioRecorder.onstop = () => {
                        audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        recordingStatus.textContent = 'ÎÖπÏùå ÏôÑÎ£å! Ï†úÏ∂úÌïòÎ†§Î©¥ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî';
                        submitVoiceBtn.style.display = 'inline-block';
                        stream.getTracks().forEach(track => track.stop());
                    };
                    audioRecorder.start();
                    recordBtn.textContent = '‚èπÔ∏è';
                    recordingStatus.textContent = 'ÎÖπÏùå Ï§ë... Ï§ëÏßÄÌïòÎ†§Î©¥ Îã§Ïãú ÌÅ¥Î¶≠';
                    submitVoiceBtn.style.display = 'none';
                } catch (error) {
                    alert('ÎßàÏù¥ÌÅ¨ Í∂åÌïúÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.');
                    console.error('ÎÖπÏùå ÏãúÏûë Ïã§Ìå®:', error);
                }
            } else if (audioRecorder.state === 'recording') {
                audioRecorder.stop();
                recordBtn.textContent = 'üé§';
            }
        }
        
        async function submitVoiceAnswer() {
            const questionId = document.getElementById('currentQuestionId').value;
            if (!audioBlob) {
                alert('Î®ºÏ†Ä ÏùåÏÑ±ÏùÑ ÎÖπÏùåÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            if (!questionId) {
                alert('ÌòÑÏû¨ ÎãµÎ≥ÄÌï† ÏßàÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            const formData = new FormData();
            formData.append('audio', audioBlob, 'answer.webm');
            formData.append('questionId', questionId);
            try {
                const token = getToken();
                const submitBtn = document.getElementById('submitVoiceBtn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Ï†úÏ∂ú Ï§ë...';
                const response = await fetch(`/api/session/${SESSION_DATA.sessionId}/voice-answer`, {
                    method: 'POST',
                    headers: {
                        'Authorization': token
                    },
                    body: formData
                });
                const result = await response.json();
                if (response.ok && result.success) {
                    alert('ÏùåÏÑ± ÎãµÎ≥ÄÏù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§!\nÎ≥ÄÌôòÎêú ÌÖçÏä§Ìä∏: ' + result.transcription);
                    audioBlob = null;
                    audioChunks = [];
                    document.getElementById('recordingStatus').textContent = 'ÎÖπÏùå ÏãúÏûëÌïòÎ†§Î©¥ ÌÅ¥Î¶≠';
                    submitBtn.style.display = 'none';
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ÎãµÎ≥Ä Ï†úÏ∂ú';
                } else {
                    alert('ÏùåÏÑ± ÎãµÎ≥Ä Ï†úÏ∂úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (result.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ÎãµÎ≥Ä Ï†úÏ∂ú';
                }
            } catch (error) {
                console.error('ÏùåÏÑ± ÎãµÎ≥Ä Ï†úÏ∂ú Ïã§Ìå®:', error);
                alert('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                const submitBtn = document.getElementById('submitVoiceBtn');
                submitBtn.disabled = false;
                submitBtn.textContent = 'ÎãµÎ≥Ä Ï†úÏ∂ú';
            }
        }
        
        function submitInterviewerFeedback(answerId) {
            const score = document.getElementById(`score-${answerId}`).value;
            const feedbackText = document.getElementById(`feedback-${answerId}`).value;
            if (!feedbackText.trim()) {
                alert('ÌîºÎìúÎ∞±ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (window.mockerViewWS && window.mockerViewWS.connected) {
                window.mockerViewWS.submitInterviewerFeedback(answerId, parseInt(score), feedbackText);
                
                const evaluationDiv = document.getElementById(`evaluation-${answerId}`);
                evaluationDiv.innerHTML = `
                    <div class="submitted-evaluation">
                        ‚úÖ ÌèâÍ∞Ä ÏôÑÎ£å (Ï†êÏàò: ${score}/100)
                    </div>
                `;
                alert('ÌèâÍ∞ÄÍ∞Ä Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§!');
            }
        }
        
        window.addEventListener('beforeunload', function() {
            console.log('üö™ ÌéòÏù¥ÏßÄ Ï¢ÖÎ£å Í∞êÏßÄ...');
            if (agoraClient && agoraClient.isJoined) {
                try {
                    agoraClient.leave();
                } catch (error) {
                    console.error('‚ö†Ô∏è Ï¢ÖÎ£å Ï§ë Ïò§Î•ò:', error);
                }
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM Î°úÎìú ÏôÑÎ£å');
            console.log('üìä SESSION_DATA:', SESSION_DATA);
            
            if (SESSION_DATA.isHost) {
                checkSessionStatus();
            }
            
            startCountdown();
            
            console.log('üîå WebSocket Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
            const ws = new MockerViewWebSocket(
                SESSION_DATA.sessionId, 
                SESSION_DATA.userId, 
                SESSION_DATA.userName
            );
            window.mockerViewWS = ws;
            ws.connect();
            console.log('‚úÖ WebSocket connect() Ìò∏Ï∂ú ÏôÑÎ£å');
            
            if ((SESSION_DATA.sessionType === 'AUDIO' || SESSION_DATA.sessionType === 'VIDEO') && !mediaInitialized) {
                setTimeout(() => {
                    console.log('üé¨ ÎØ∏ÎîîÏñ¥ Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
                    initializeMedia();
                }, 1000);
            }
        });
        
        async function checkSessionStatus() {
            try {
                const token = getToken();
                const response = await fetch(`/api/session/${SESSION_DATA.sessionId}/status`, {
                    headers: { 'Authorization': token }
                });
                
                const data = await response.json();
                console.log('üìä ÏÑ∏ÏÖò ÏÉÅÌÉú:', data);
                
                if (data.status === 'RUNNING') {
                    const startBtn = document.getElementById('startInterviewBtn');
                    const pauseBtn = document.getElementById('pauseInterviewBtn');
                    const endBtn = document.getElementById('endInterviewBtn');
                    const badge = document.getElementById('sessionStatusBadge');
                    
                    if (startBtn) startBtn.style.display = 'none';
                    if (pauseBtn) pauseBtn.style.display = 'inline-block';
                    if (endBtn) endBtn.style.display = 'inline-block';
                    
                    if (badge) {
                        badge.textContent = 'ÏßÑÌñâÏ§ë';
                        badge.className = 'status-badge ongoing';
                    }
                    
                    console.log('‚úÖ UI ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å - RUNNING ÏÉÅÌÉú');
                }
            } catch (error) {
                console.error('‚ùå ÏÑ∏ÏÖò ÏÉÅÌÉú ÌôïÏù∏ Ïã§Ìå®:', error);
            }
        }
    </script>
</body>
</html>