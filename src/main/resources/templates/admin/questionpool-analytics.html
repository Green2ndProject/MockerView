<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuestionPool í•™ìŠµ ë¶„ì„ - MockerView Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            background: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .header {
            background: #667eea;
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        .stat-number {
            font-size: 42px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
            min-height: 60px;
        }
        .stat-label {
            font-size: 14px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .proof-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .mechanism-step {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .btn-force-learning {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-force-learning:hover {
            background: #5568d3;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102,126,234,0.3);
        }
        .badge-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        .status-optimal { background: #d4edda; color: #155724; }
        .status-advanced { background: #d1ecf1; color: #0c5460; }
        .status-learning { background: #fff3cd; color: #856404; }
        .status-initial { background: #f8d7da; color: #721c24; }
        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 15px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1 class="mb-0">ğŸ¤– QuestionPool í•™ìŠµ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
            <p class="mb-0 mt-2">Continuous Feedback Learning System</p>
        </div>
    </div>

    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <div class="proof-section">
                    <h2 class="mb-4">ğŸ’¡ ì‹œìŠ¤í…œ íš¨ìœ¨í™” ì¦ëª…</h2>
                    <div class="alert alert-info">
                        <h5 class="alert-heading">í•µì‹¬ ëª…ì œ</h5>
                        <p class="mb-0"><strong>"AIê°€ ë˜‘ë˜‘í•´ì§€ëŠ” ê²Œ ì•„ë‹ˆë¼ ì‹œìŠ¤í…œì´ íš¨ìœ¨í™”ëœë‹¤"</strong></p>
                    </div>
                    
                    <h5 class="mt-4 mb-3">ì‘ë™ ë©”ì»¤ë‹ˆì¦˜</h5>
                    <div class="mechanism-step">
                        <strong>1ë‹¨ê³„:</strong> ì‚¬ìš©ì ë‹µë³€ ëˆ„ì  â†’ ë°ì´í„° ìˆ˜ì§‘
                    </div>
                    <div class="mechanism-step">
                        <strong>2ë‹¨ê³„:</strong> ë‹µë³€ 5ê°œ ì´ìƒ + í‰ê·  70ì  ì´ìƒ â†’ ê²€ì¦
                    </div>
                    <div class="mechanism-step">
                        <strong>3ë‹¨ê³„:</strong> ê²€ì¦ëœ ì§ˆë¬¸ â†’ QuestionPool ì €ì¥
                    </div>
                    <div class="mechanism-step">
                        <strong>4ë‹¨ê³„:</strong> ìƒˆ ì§ˆë¬¸ ìš”ì²­ ì‹œ QuestionPool ìš°ì„  ì‚¬ìš©
                    </div>
                    <div class="mechanism-step">
                        <strong>5ë‹¨ê³„:</strong> AI API í˜¸ì¶œ ê°ì†Œ â†’ ë¹„ìš© ì ˆê° ë° ì†ë„ í–¥ìƒ
                    </div>
                    
                    <div class="text-center mt-4">
                        <button class="btn-force-learning" onclick="forceLearning()">
                            ğŸš€ ì¦‰ì‹œ í•™ìŠµ ì‹¤í–‰
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-label">QuestionPool í¬ê¸°</div>
                    <div class="stat-number" id="poolSize">
                        <div class="loading-spinner"></div>
                    </div>
                    <small class="text-muted">ê²€ì¦ëœ ì§ˆë¬¸</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-label">AI ì‚¬ìš©ë¥ </div>
                    <div class="stat-number" id="aiUsageRate">
                        <div class="loading-spinner"></div>
                    </div>
                    <small class="text-muted">API í˜¸ì¶œ ë¹„ìœ¨</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-label">ìºì‹œ íˆíŠ¸ìœ¨</div>
                    <div class="stat-number" id="cacheHitRate">
                        <div class="loading-spinner"></div>
                    </div>
                    <small class="text-muted">Pool ì¬ì‚¬ìš©ìœ¨</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-label">ì›”ê°„ ë¹„ìš© ì ˆê°</div>
                    <div class="stat-number" id="costSavings">
                        <div class="loading-spinner"></div>
                    </div>
                    <small class="text-muted">USD</small>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="stat-card">
                    <div class="stat-label">ì‹œìŠ¤í…œ ì„±ìˆ™ë„</div>
                    <div class="mt-3">
                        <span class="badge-status" id="maturityBadge">
                            <div class="loading-spinner" style="width: 20px; height: 20px; border-width: 2px;"></div>
                        </span>
                    </div>
                    <p class="mt-3 mb-0" id="statusMessage">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <h5 class="mb-4">í•™ìŠµ ê³¡ì„  (Learning Curve)</h5>
                    <canvas id="learningCurveChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h5 class="mb-4">íš¨ìœ¨ì„± ë¶„í¬</h5>
                    <canvas id="efficiencyChart"></canvas>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="chart-container">
                    <h5 class="mb-4">ì„±ëŠ¥ í–¥ìƒ ì§€í‘œ</h5>
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let learningCurveChart, efficiencyChart, performanceChart;

        async function loadStats() {
            try {
                const response = await fetch('/api/analytics/questionpool/stats');
                const stats = await response.json();
                
                document.getElementById('poolSize').textContent = stats.poolQuestions.toLocaleString();
                document.getElementById('aiUsageRate').textContent = stats.aiUsageRate.toFixed(1) + '%';
                document.getElementById('cacheHitRate').textContent = stats.cacheHitRate.toFixed(1) + '%';
                document.getElementById('costSavings').textContent = '$' + stats.costSavings.monthlySavings.toFixed(2);
                
                const badge = document.getElementById('maturityBadge');
                badge.textContent = stats.maturityLevel;
                badge.className = 'badge-status ' + getStatusClass(stats.maturityLevel);
                
                document.getElementById('statusMessage').textContent = stats.message;
                
                updateCharts(stats);
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('poolSize').textContent = 'ì˜¤ë¥˜';
                document.getElementById('aiUsageRate').textContent = 'ì˜¤ë¥˜';
                document.getElementById('cacheHitRate').textContent = 'ì˜¤ë¥˜';
                document.getElementById('costSavings').textContent = 'ì˜¤ë¥˜';
                document.getElementById('maturityBadge').textContent = 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
                document.getElementById('statusMessage').textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.';
            }
        }

        async function loadLearningCurve() {
            try {
                const response = await fetch('/api/analytics/questionpool/learning-curve');
                const data = await response.json();
                return data.projectedCurve;
            } catch (error) {
                console.error('í•™ìŠµ ê³¡ì„  ë¡œë“œ ì‹¤íŒ¨:', error);
                return [];
            }
        }

        async function updateCharts(stats) {
            const curveData = await loadLearningCurve();
            
            if (learningCurveChart) learningCurveChart.destroy();
            if (efficiencyChart) efficiencyChart.destroy();
            if (performanceChart) performanceChart.destroy();
            
            const ctx1 = document.getElementById('learningCurveChart').getContext('2d');
            learningCurveChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: curveData.map(d => d.phase),
                    datasets: [{
                        label: 'AI ì‚¬ìš©ë¥  (%)',
                        data: curveData.map(d => d.aiUsageRate),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: value => value + '%' }
                        }
                    }
                }
            });
            
            const ctx2 = document.getElementById('efficiencyChart').getContext('2d');
            efficiencyChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['ìºì‹œ íˆíŠ¸ (Pool ì‚¬ìš©)', 'AI í˜¸ì¶œ'],
                    datasets: [{
                        data: [stats.cacheHitRate, stats.aiUsageRate],
                        backgroundColor: ['#667eea', '#f8d7da']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            
            const ctx3 = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: ['ìºì‹œ ì‘ë‹µ', 'AI ì‘ë‹µ', 'í‰ê·  ì‘ë‹µ'],
                    datasets: [{
                        label: 'ì‘ë‹µ ì‹œê°„ (ms)',
                        data: [
                            stats.performanceMetrics.cacheResponseTime,
                            stats.performanceMetrics.aiResponseTime,
                            stats.performanceMetrics.avgResponseTime
                        ],
                        backgroundColor: ['#667eea', '#f8d7da', '#fff3cd']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: value => value + 'ms' }
                        }
                    }
                }
            });
        }

        async function forceLearning() {
            if (!confirm('QuestionPool í•™ìŠµì„ ì¦‰ì‹œ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch('/api/analytics/questionpool/force-learning', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                alert(`í•™ìŠµ ì™„ë£Œ!\n\n` +
                        `ìƒˆë¡œ ì¶”ê°€ëœ ì§ˆë¬¸: ${result.improvement.newQuestions}ê°œ\n` +
                        `AI ì‚¬ìš©ë¥  ê°ì†Œ: ${result.improvement.aiRateReduction.toFixed(2)}%\n` +
                        `ì˜ˆìƒ ë¹„ìš© ì ˆê°: $${result.improvement.costSavings.toFixed(2)}/ì›”`);
                
                loadStats();
            } catch (error) {
                alert('í•™ìŠµ ì‹¤í–‰ ì‹¤íŒ¨: ' + error.message);
            }
        }

        function getStatusClass(maturity) {
            if (maturity.includes('ì™„ì „')) return 'status-optimal';
            if (maturity.includes('ê³ ë„í™”')) return 'status-advanced';
            if (maturity.includes('ì„±ì¥')) return 'status-learning';
            return 'status-initial';
        }

        loadStats();
        setInterval(loadStats, 30000);
    </script>
</body>
</html>